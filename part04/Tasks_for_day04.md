# Day 04 - Piscine SQL

## _Снимки, виртуальные таблицы… Что происходит?_

Резюме: Сегодня вы увидите, как использовать виртуальный просмотр и физический снимок данных

## Rules of the day

- Наш способ получения знаний является постепенным и линейным, поэтому, пожалуйста, имейте в виду, что все изменения, которые вы внесли в День 03 во время упражнений 07-13, должны быть на месте (это похоже на то, что происходит в реальном мире, когда мы применяем релиз и должны быть согласованы с данными для новых изменений).

![schema](../materials/images/schema.png)


## Exercise 00 - Let’s create separated views for persons

| Exercise 00: Let’s create separated views for persons |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex00                                                                                                                     |
| Files to turn-in                      | `day04_ex00.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |

Пожалуйста, создайте 2 представления базы данных (с такими же атрибутами, как в исходной таблице) на основе простой фильтрации по полу лиц. Задайте соответствующие имена для представлений базы данных: `v_persons_female` и `v_persons_male`.


## Exercise 01 - From parts to common view

| Exercise 01: From parts to common view|                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex01                                                                                                                     |
| Files to turn-in                      | `day04_ex01.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |

Пожалуйста, используйте 2 представления базы данных из упражнения №00 и напишите SQL, чтобы получить женские и мужские имена в одном списке. Пожалуйста, задайте порядок по имени человека. Пример данных представлен ниже.

| name |
| ------ |
| Andrey |
| Anna |
| ... |


## Exercise 02 - “Store” generated dates in one place

| Exercise 02: “Store” generated dates in one place|                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex02                                                                                                                     |
| Files to turn-in                      | `day04_ex02.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |
| SQL Syntax Construction                        | `generate_series(...)`                                                                                              |

Пожалуйста, создайте представление базы данных (с именем `v_generated_dates`), в котором должны быть сгенерированы даты с 1 по 31 января 2022 года в формате DATE. Не забудьте о порядке для столбца generated_date.  

| generated_date |
| ------ |
| 2022-01-01 |
| 2022-01-02 |
| ... |


## Exercise 03 - Find missing visit days with Database View

| Exercise 03: Find missing visit days with Database View |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex03                                                                                                                     |
| Files to turn-in                      | `day04_ex03.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |


Пожалуйста, напишите инструкцию SQL, которая возвращает пропущенные дни для посещений людей в январе 2022 года. Используйте для этой задачи представление `v_generated_dates` и отсортируйте результат по столбцу missing_data. Ниже представлен пример данных.

| missing_date |
| ------ |
| 2022-01-11 |
| 2022-01-12 |
| ... |


## Exercise 04 - Let’s find something from Set Theory


| Exercise 04: Let’s find something from Set Theory |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex04                                                                                                                     |
| Files to turn-in                      | `day04_ex04.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |

Пожалуйста, напишите инструкцию SQL, которая удовлетворяет формуле `(R - S)∪(S - R)`.
Где R - таблица `person_visits` с фильтром по состоянию на 2 января 2022 года, S - также таблица `person_visits`, но с другим фильтром по состоянию на 6 января 2022 года. Пожалуйста, произведите свои вычисления с наборами в столбце `person_id`, и этот столбец будет единственным в результате. Результат, пожалуйста, отсортируйте по столбцу `person_id`, а ваш окончательный SQL-запрос, пожалуйста, представьте в представлении базы данных  `v_symmetric_union` (*).

(*) честно говоря, определения “симметричное объединение” в теории множеств не существует. Это авторская интерпретация, основная идея которой основана на существующем правиле симметричного различия.


## Exercise 05 - Let’s calculate a discount price for each person


| Exercise 05: Let’s calculate a discount price for each person |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex05                                                                                                                     |
| Files to turn-in                      | `day04_ex05.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |

Пожалуйста, создайте представление базы данных `v_price_with_discount`, которое возвращает заказы пользователя с именами пользователей, названиями пицц, реальной ценой и рассчитанным столбцом "discount_price" (с применяемой скидкой 10% и удовлетворяет формуле `price - price*0.1`). Результат, пожалуйста, отсортируйте по имени пользователя и названию пиццы и преобразуйте столбец `discount_price` в целое число. Пожалуйста, взгляните на пример результата ниже.


| name |  pizza_name | price | discount_price |
| ------ | ------ | ------ | ------ | 
| Andrey | cheese pizza | 800 | 720 | 
| Andrey | mushroom pizza | 1100 | 990 |
| ... | ... | ... | ... |


## Exercise 06 - Materialization from virtualization


| Exercise 06: Materialization from virtualization |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex06                                                                                                                     |
| Files to turn-in                      | `day04_ex06.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |

Пожалуйста, создайте материализованное представление `mv_dmitriy_visits_and_eats` (с включенными данными) на основе инструкции SQL, которая находит название пиццерии, которую Дмитрий посетил 8 января 2022 года и мог съесть пиццу менее чем за 800 рублей (этот SQL вы можете узнать в День #02, упражнение #07). 

Чтобы проверить себя, вы можете записать SQL в материализованное представление `mv_dmitriy_visits_and_eats` и сравнить результаты с вашим предыдущим запросом.


## Exercise 07 - Refresh our state


| Exercise 07: Refresh our state|                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex07                                                                                                                     |
| Files to turn-in                      | `day04_ex07.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |
| **Denied**                               |                                                                                                                          |
| SQL Syntax Pattern                        | Don’t use direct numbers for identifiers of Primary Key, person and pizzeria                                                                                               |

Давайте обновим данные в нашем материализованном представлении `mv_dmitriy_visits_and_eats` из упражнения №06. Перед выполнением этого действия, пожалуйста, сгенерируйте еще один визит Дмитрия, который удовлетворяет условиям SQL для Materialized View, за исключением пиццерии, которую мы видим в результате упражнения #06.
После добавления нового посещения, пожалуйста, обновите состояние данных для `mv_dmitriy_visits_and_eats`.

## Exercise 08 - Just clear our database


| Exercise 08: Just clear our database |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex08                                                                                                                     |
| Files to turn-in                      | `day04_ex08.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |           

После всех наших упражнений на свет появилось несколько виртуальных таблиц и один материализованный вид. Давайте отбросим их!

[Вернуться в README.md](../README.md)
