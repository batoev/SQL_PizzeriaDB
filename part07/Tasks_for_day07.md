# Day 07 - Piscine SQL

## _Агрегированные данные более информативны, не так ли?_

Резюме: Сегодня вы увидите, как использовать конкретные OLAP-конструкции для получения “ценности” из данных

## Rules of the day

- Наш способ получения знаний является постепенным и линейным, поэтому, пожалуйста, имейте в виду, что все изменения, которые вы внесли в День 03 во время упражнений 07-13, должны быть на месте (это похоже на то, что происходит в реальном мире, когда мы применяем релиз и должны быть согласованы с данными для новых изменений).

![schema](../materials/images/schema.png)

## Exercise 00 - Simple aggregated information

| Exercise 00: Simple aggregated information |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex00                                                                                                                     |
| Files to turn-in                      | `day07_ex00.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL|

Давайте проведем простую статистику, пожалуйста, напишите SQL-инструкцию, которая возвращает идентификаторы пользователей и соответствующее количество посещений любых пиццерий, а также сортировку по количеству посещений в режиме убывания и сортировку по `person_id` в режиме возрастания. Пожалуйста, взгляните на образец данных ниже.

| person_id | count_of_visits |
| ------ | ------ |
| 9 | 4 |
| 4 | 3 |
| ... | ... | 


## Exercise 01 - Let’s see real names

| Exercise 01: Let’s see real names|                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex01                                                                                                                     |
| Files to turn-in                      | `day07_ex01.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |

Пожалуйста, измените инструкцию SQL из упражнения 00 и верните имя пользователя (а не идентификатор). Дополнительное условие - нам нужно видеть только топ-4 пользователей с максимальным количеством посещений любых пиццерий, отсортированных по имени пользователя. Пожалуйста, взгляните на пример выходных данных ниже.

| name | count_of_visits |
| ------ | ------ |
| Dmitriy | 4 |
| Denis | 3 |
| ... | ... | 


## Exercise 02 - Restaurants statistics

| Exercise 02: Restaurants statistics|                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex02                                                                                                                     |
| Files to turn-in                      | `day07_ex02.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |

Пожалуйста, напишите SQL-запрос, чтобы отобразить 3 любимых ресторана по посещениям и заказам в одном списке (пожалуйста, добавьте столбец action_type со значениями "заказ" или "посещение", это зависит от данных из соответствующей таблицы). Пожалуйста, взгляните на образец данных ниже. Результат должен быть отсортирован по столбцу action_type в режиме возрастания и по столбцу count в режиме убывания.

| name | count | action_type |
| ------ | ------ | ------ |
| Dominos | 6 | order |
| ... | ... | ... |
| Dominos | 7 | visit |
| ... | ... | ... |

## Exercise 03 - Restaurants statistics #2

| Exercise 03: Restaurants statistics #2 |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex03                                                                                                                     |
| Files to turn-in                      | `day07_ex03.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |

Пожалуйста, напишите инструкцию SQL, чтобы увидеть, как рестораны группируются по посещениям и заказам и объединяются друг с другом с помощью названия ресторана.  
Вы можете использовать внутренний Sql из упражнения 02 (рестораны по посещениям и заказам) без ограничений на количество строк.

Дополнительно, пожалуйста, добавьте следующие правила.
- подсчитайте сумму заказов и посещений для соответствующей пиццерии (имейте в виду, что не все ключи от пиццерий представлены в обеих таблицах).
- отсортируйте результаты по столбцу `total_count` в порядке убывания и по `name` в порядке возрастания.
Взгляните на приведенный ниже пример данных.

| name | total_count |
| ------ | ------ |
| Dominos | 13 |
| DinoPizza | 9 |
| ... | ... | 


## Exercise 04 - Clause for groups


| Exercise 04: Clause for groups |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex04                                                                                                                     |
| Files to turn-in                      | `day07_ex04.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |
| **Denied**                               |                                                                                                                          |
| Syntax construction                        | `WHERE`                                                                                              |

Пожалуйста, напишите SQL-запрос, который возвращает имя посетителя и соответствующее количество посещений любых пиццерий, если этот человек посещал их более 3 раз (> 3).Пожалуйста, взгляните на образец данных, приведенный ниже.

| name | count_of_visits |
| ------ | ------ |
| Dmitriy | 4 |



## Exercise 05 - Person's uniqueness


| Exercise 05: Person's uniqueness|                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex05                                                                                                                     |
| Files to turn-in                      | `day07_ex05.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        |  ANSI SQL                                                                                              |
| **Denied**                               |                                                                                                                          |
| Syntax construction                        |  `GROUP BY`, any type (`UNION`,...) working with sets                                                                                              |

Пожалуйста, напишите простой SQL-запрос, который возвращает список уникальных имен пользователей, которые делали заказы в любых пиццериях. Результат должен быть отсортирован по имени пользователя. Пожалуйста, взгляните на пример ниже.

| name | 
| ------ |
| Andrey |
| Anna | 
| ... | 

## Exercise 06 - Restaurant metrics


| Exercise 06: Restaurant metrics|                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex06                                                                                                                     |
| Files to turn-in                      | `day07_ex06.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |

Пожалуйста, напишите SQL-запрос, который возвращает количество заказов, среднюю цену, максимальную и минимальную цены на проданную пиццу в соответствующей пиццерии-ресторане. Результат должен быть отсортирован по названию пиццерии. Пожалуйста, ознакомьтесь с приведенным ниже образцом данных. 
Округлите вашу среднюю цену до 2 чисел с плавающей запятой.

| name | count_of_orders | average_price | max_price | min_price |
| ------ | ------ | ------ | ------ | ------ |
| Best Pizza | 5 | 780 | 850 | 700 |
| DinoPizza | 5 | 880 | 1000 | 800 |
| ... | ... | ... | ... | ... |


## Exercise 07 - Average global rating


| Exercise 07: Average global rating|                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex07                                                                                                                     |
| Files to turn-in                      | `day07_ex07.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |

Пожалуйста, напишите инструкцию SQL, которая возвращает общий средний рейтинг (имя выходного атрибута - global_rating) для всех ресторанов. Округлите ваш средний рейтинг до 4 чисел с плавающей запятой.


## Exercise 08 - Find pizzeria’s restaurant locations


| Exercise 08: Find pizzeria’s restaurant locations|                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex08                                                                                                                     |
| Files to turn-in                      | `day07_ex08.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |

Мы знаем о личных адресах из наших данных. Давайте представим, что конкретный человек посещает пиццерии только в своем городе. Пожалуйста, напишите SQL-запрос, который возвращает адрес, название пиццерии и количество заказов, сделанных людьми. Результат должен быть отсортирован по адресу, а затем по названию ресторана. Пожалуйста, ознакомьтесь с приведенным ниже образцом выходных данных.

| address | name |count_of_orders |
| ------ | ------ |------ |
| Kazan | Best Pizza |4 |
| Kazan | DinoPizza |4 |
| ... | ... | ... | 


## Exercise 09 - Explicit type transformation


| Exercise 09: Explicit type transformation|                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Turn-in directory                     | ex09                                                                                                                     |
| Files to turn-in                      | `day07_ex09.sql`                                                                                 |
| **Allowed**                               |                                                                                                                          |
| Language                        | ANSI SQL                                                                                              |

Пожалуйста, напишите SQL-инструкцию, которая возвращает агрегированную информацию по адресу человека, результат “Maximal Age - (Minimal Age  / Maximal Age)”, который представлен в виде столбца формулы, следующий - средний возраст по адресу и результат сравнения столбцов формулы и среднего значения (другими словами, если формула больше среднего значения, тогда значение True, в противном случае значение False).

Результат должен быть отсортирован по столбцу адреса. Пожалуйста, ознакомьтесь с приведенным ниже образцом выходных данных.

| address | formula |average | comparison |
| ------ | ------ |------ |------ |
| Kazan | 44.71 |30.33 | true |
| Moscow | 20.24 | 18.5 | true |
| ... | ... | ... | ... |

[Вернуться в README.md](../README.md)
